<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Travel and Entertainment Search</title>
        
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
        
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!-- Popper JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
        
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&key=google_map_api_key_for_place" ></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-animate.js"></script>

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
        <style type="text/css">

            .content { padding: 1rem; }
            
            .searchDiv { position: relative; padding: 1rem; border: solid #999; background-color: #f2f2f2; border-width: .2rem; }
            .searchDiv h1 { font-size: 1.9rem; }

            .reddot1 { background-image: url(img_reddot.gif); background-repeat: no-repeat; background-position-x: 80px; background-position-y: 13px; }
            .reddot2 { background-image: url(img_reddot.gif); background-repeat: no-repeat; background-position-x: 54px; background-position-y: 7px; }

            th.resultCell0 { width: 5%; }
            th.resultCell1 { width: 10%; }
            th.resultCell2 { width: 35%; min-width: 200px; }
            th.resultCell3 { width: 40%; min-width: 220px; }
            th.resultCell4 { width: 5%; }
            th.resultCell5 { width: 5%; }

            th.infoCell0 { width: 30%; }
            td.infoCell1 { width: 10000px; }

            td .btn-outline-dark { background-color: white; width: 37.31px; height: 38px; }
            
            /* Extra small devices (portrait phones, less than 576px) */
            /* No media query since this is the default in Bootstrap */
            
            /* Small devices (landscape phones, 576px and up) */
            @media (min-width: 576px) {

                .searchDiv { padding-left: 3rem; padding-right: 3rem; width: 576px; }
                .searchDiv label { font-weight: 500; }
                .searchDiv legend { font-weight: 500; }
                .searchDiv .shorter { width: 70%; }

                .card-columns { column-count: 2; }
            }

            /* Medium devices (tablets, 768px and up) */
            @media (min-width: 768px) {
                .searchDiv { padding-left: 7rem; padding-right: 7rem; width: 768px; }
                .card-columns { column-count: 3; }
            }

            /* Large devices (desktops, 992px and up) */
            @media (min-width: 992px) {
                .searchDiv { padding-left: 10rem; padding-right: 10rem; width: 992px; }
                .card-columns { column-count: 4; }
            }

            /* Extra large devices (large desktops, 1200px and up) */
            @media (min-width: 1200px) {
                .card-columns { column-count: 5; }
            }

            ul.nav-center {
                margin: 0 auto;
                width: max-content;
                width: -moz-fit-content;
            }

            .table tbody th, .table tbody td {
                vertical-align: middle;
            }

            img.categoryImg {
                height: 35px;
            }

            img.reviewIcon {
                width: 50px;
            }

            input.twitterBtn {
                background-image: url(http://cs-server.usc.edu:45678/hw/hw8/images/Twitter.png);
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
                width: 42px;
                height: 38px;
            }

            input.streetViewBtn {
                background-image: url(http://cs-server.usc.edu:45678/hw/hw8/images/Pegman.png);                
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
                border: 1px solid #ced4da;
                width: 42px;
                height: 38px;
            }

            input.mapViewBtn {
                background-image: url(http://cs-server.usc.edu:45678/hw/hw8/images/Map.png);
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
                border: 1px solid #ced4da;
                width: 42px;
                height: 38px;
            }

            input.favorite {
                color: #EB6E00;
            }

            #detailDiv #nav-tabs {
                border-bottom: 1px solid #dee2e6;
            }
            #detailDiv .nav-tabs {
                border-bottom: none;
            }

            @keyframes slideToRight {
                from {
                    left: -100%;
                } to {
                    left: 0;
                }
            }

            @keyframes slideToLeft {
                from {
                    left: 100%;
                } to {
                    left: 0%;
                }
            }

            #listDiv {
                position: relative;
            }

            #listDiv.ng-hide-add {
                display: none;
            }

            #listDiv.ng-hide-remove {
                animation: 1s slideToLeft;
            }

            #listDiv.ng-hide-remove {
                display: block;
            }

            #detailDiv {
                position: relative;
            }

            #detailDiv.ng-hide-add {
                display: none;
            }

            #detailDiv.ng-hide-remove {
                animation: 1s slideToRight;
            }

            #detailDiv.ng-hide-remove {
                display: block;
            }

            /* The starting CSS styles for the enter animation */
            .fade {
                transition: opacity .5s;
                opacity: 1;
            }

            /* The starting CSS styles for the enter animation */
            .fade.ng-enter, .fade.ng-leave-active {
                opacity: 0;
            }

            /* The finishing CSS styles for the enter animation */
            .fade.ng-leave, .fade.ng-enter-active {
                opacity: 1;
            }

            /* 

            .reddot {
                position: relative;
                left: -10px;
                top: -12px;
            } */
            
        </style>
        <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.21.0/moment.min.js"></script>
        <script type="text/javascript">
            FontAwesomeConfig = { searchPseudoElements: true };

            // Constructor -- pass a REST request URL to the constructor
            function JSONscriptRequest(fullUrl) {
                // REST request path
                this.fullUrl = fullUrl;
                
                // Keep IE from caching requests
                this.noCacheIE = '&noCacheIE=' + (new Date()).getTime();

                // Get the DOM location to put the script tag
                this.headLoc = document.getElementsByTagName("head").item(0);

                // Generate a unique script tag id
                this.scriptId = 'JscriptId' + JSONscriptRequest.scriptCounter++;
            }

            // Static script ID counter
            JSONscriptRequest.scriptCounter = 1;

            // buildScriptTag method
            JSONscriptRequest.prototype.buildScriptTag = function () {
                // Create the script tag
                this.scriptObj = document.createElement("script");
                
                // Add script object attributes
                this.scriptObj.setAttribute("type", "text/javascript");                
                this.scriptObj.setAttribute("charset", "utf-8");
                this.scriptObj.setAttribute("src", this.fullUrl);// + this.noCacheIE);
                this.scriptObj.setAttribute("id", this.scriptId);
            }

            // removeScriptTag method
            JSONscriptRequest.prototype.removeScriptTag = function () {
                // Destroy the script tag
                this.headLoc.removeChild(this.scriptObj);
            }

            // addScriptTag method
            JSONscriptRequest.prototype.addScriptTag = function () {
                // Create the script tag
                this.headLoc.appendChild(this.scriptObj);
            }

            // scriptObj for jsonp
            var scriptObj = null;
            window.onload = function() {                
                var radioNodes = document.getElementsByName("from");                
                for (var i=0; i<radioNodes.length; i++) {
                    radioNodes[i].addEventListener("change", function(e) {
                        if ("location" == this.value) {
                            document.getElementsByName("addr")[0].disabled = !(this.checked);
                        } else {
                            document.getElementsByName("addr")[0].disabled = this.checked;
                        }
                        $('#send')[0].disabled = !isValidated();                        
                    });                    
                }

                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = $('#searchForm');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false || !isValidated($('#keyword')[0]) || !isValidated($('#addr'))) {
                            event.preventDefault();
                            event.stopPropagation();
                            if (!isValidated($('#keyword')[0])) {
                                $('#keyword')[0].value = "";
                            } else {
                                $('#addr')[0].value = "";
                            }
                            $('.needs-validation')[0].classList.add('was-validated');
                            $('#send')[0].disabled = true;
                            return false;
                        }

                        $('#btnDetails')[0].disabled = true;

                        var eleInputs = this.getElementsByTagName("input");
                        var eleSels = this.getElementsByTagName("select")[0];

                        var dataStr = `latitude=${sessionStorage.currentLatitude}&longitude=${sessionStorage.currentLongitude}`;
                        dataStr += `&${eleSels.name}=${eleSels.value}`;
                        for (var i=0; i<eleInputs.length; i++) {
                            if ("radio" == eleInputs[i].type) {
                                if (eleInputs[i].checked) {
                                    dataStr += `&${eleInputs[i].name}=${eleInputs[i].value}`;
                                }
                            } else {
                                dataStr += `&${eleInputs[i].name}=${eleInputs[i].value}`;
                            }
                        }

                        // Call ajax
                        loadJSON({
                            url: '/googlemap/nearby',
                            actionType: "GET",
                            data: dataStr,
                            async: true,
                            progress: true,
                            callback: function(retStr) {
                                if (0 < retStr.length) {
                                    try {        
                                        var retObj = JSON.parse(retStr);
                                        retObj.results.next_page_token = retObj.next_page_token;
                                        var dataObj = getDataObj();
                                        dataObj.setResult(retObj.results);
                                        dataObj.setCurFavoritePageIdx(0);
                                        setPillActive("Result");
                                        drawList("Result");
                                        showSlide(0);
                                        
                                        // Set orginated position.
                                        if (retObj.geometry) {
                                            sessionStorage.latitude = retObj.geometry.lat;
                                            sessionStorage.longitude = retObj.geometry.lng;
                                        }
                                    } catch (e) {
                                        if (e instanceof SyntaxError) {
                                            alert("Fail to parse JSON.");
                                        }

                                        console.log(e);
                                    }
                                }
                            }
                        });
                        
                        // Stops event bubbling.
                        event.preventDefault();
                        event.stopPropagation();

                        return false;
                    }, false);
                });

                document.getElementById("Clear").addEventListener("click", function(e) {
                    var form = $("#searchForm")[0];
                    
                    form.reset();
                    document.getElementsByName("addr")[0].disabled = true;
                    setPillActive(this.innerHTML.trim());
                    $("#progress")[0].style.display = "none";  
                    $("#result")[0].style.display = "none";
                    $("#alertForFail")[0].style.display = "none";
                    $('#send')[0].disabled = true
                });

                // list views click event controllers.
                $.each($('.nav-pills a'), function(index, item) {
                    item.addEventListener("click", function(e) {
                        e.preventDefault();
                        e.stopPropagation();

                        setPillActive(this.innerHTML.trim());
                        drawList(this.innerHTML.trim());
                    });
                });

                $.each($('#btnDetails'), function(index, item) {
                    item.addEventListener("click", function() {
                        // Show detail view
                        showSlide(1);
                    });
                });

                document.getElementById("btnNext").addEventListener("click", function(e) {
                    var dataObj = getDataObj();
                    var results = dataObj.getResult();

                    if (results.next) {
                        dataObj.setResult(results.next);
                        drawList("Result");
                        return;
                    }

                    // Call ajax
                    var retStr = loadJSON({
                        url: '/googlemap/nearbyNext',
                        actionType: "GET",
                        data: `pagetoken=${results.next_page_token}`,
                        async: true,
                        callback: function(retStr) {
                            if (0 < retStr.length) {
                                try {
                                    var retObj = JSON.parse(retStr);
                                    retObj.results.next_page_token = retObj.next_page_token;
                                    retObj.results.prev = results;
                                    results.next = retObj.results;
                                    dataObj.setResult(retObj.results);

                                    drawList("Result");
                                } catch (e) {
                                    if (e instanceof SyntaxError) {
                                        alert("Fail to parse JSON.");
                                    }

                                    console.log(e);
                                }
                            }
                        }
                    });
                }, false);

                document.getElementById("btnPrev").addEventListener("click", function(e) {
                    var dataObj = getDataObj();
                    var results = dataObj.getResult();

                    dataObj.setResult(results.prev);
                    drawList("Result");
                }, false);

                document.getElementById("btnFavoriteNext").addEventListener("click", function(e) {
                    var dataObj = getDataObj();
                    var favorites = dataObj.getFavorite();

                    var idx = dataObj.getCurFavoritePageIdx();
                    idx++;
                    var splice = favorites.splice(20*idx,favorites.length);
                    renderFavorites(splice);
                    dataObj.setCurFavoritePageIdx(idx);
                }, false);

                document.getElementById("btnFavoritePrev").addEventListener("click", function(e) {
                    var dataObj = getDataObj();
                    var results = dataObj.getResult();

                    var favorites = dataObj.getFavorite();

                    var idx = dataObj.getCurFavoritePageIdx();
                    idx--;
                    var splice = favorites.splice(20*idx,favorites.length);
                    renderFavorites(splice);
                    dataObj.setCurFavoritePageIdx(idx);
                }, false);

                document.getElementById("btnList").addEventListener("click", function(e) {
                    $('#btnDetails')[0].disabled = false;
                    
                    // Redraw listview.
                    $.each($('.nav-pills a'), function(index, item) {
                        if (0 < item.getAttribute("class").indexOf(" active")) {
                            drawList(item.innerHTML.trim());
                        }
                    });

                    // Show listview
                    showSlide(0);
                }, false);

                document.getElementById("btnFavorite").addEventListener("click", function(e) {
                    var dataObj = getDataObj();
                    var info = dataObj.getInfo();
                    var favorites = dataObj.getFavorite();

                    if (info.link.favorite) {
                        drawFavorite({ ele: this, isFavorite: false });
                        info.link.favorite = false;

                        for (var i=0; i<favorites.length; i++) {
                            if (favorites[i].place_id == info.link.place_id) {
                                favorites.splice(i,1);
                            }

                        }
                        dataObj.setFavorite(favorites);
                    } else {
                        drawFavorite({ ele: this, isFavorite: true });
                        info.link.favorite = true;
                        info.link.selectedInFavorite = isPillActive("Favorites");
                        favorites.push(info.link);
                        dataObj.setFavorite(favorites);
                    }
                }, false);

                document.getElementById("btnTwitte").addEventListener("click", function(e) {
                    var info = getDataObj().getInfo();
                    var text = `Check out ${window.encodeURIComponent(info.name)} located at ${window.encodeURIComponent(info.formatted_address)}. Website:`;
                    var url = `https://twitter.com/intent/tweet?text=${text}&hashtags=TravelAndEntertainmentSearch&url=${window.encodeURIComponent(info.website)}`;
                    window.open(url, 'twitter', "width=550, height=255, resizable=yes");
                }, false);

                // detail view tab event controller.
                $.each($('.nav-tabs a'), function(index, item) {
                    item.addEventListener("click", function(e) {
                        // Stops event bubbling.
                        e.preventDefault();
                        e.stopPropagation();

                        var tabEles = {
                            Info : $('#infoDiv')[0],
                            Photos: $('#photoDiv')[0],
                            Map: $('#mapDiv')[0],
                            Reviews: $('#reviewDiv')[0]
                        };

                        var tabLinks = $('.nav-tabs a');
                        for (var i=0; i<tabLinks.length; i++) {
                            if (this.innerHTML.trim() == tabLinks[i].innerHTML.trim()) {
                                tabEles[tabLinks[i].innerHTML.trim()].style.display = "";
                            } else {
                                tabEles[tabLinks[i].innerHTML.trim()].style.display = "none";
                            }
                        }

                        setNavActive(this.innerHTML.trim());
                    }, false);
                });

                // reviewType
                $.each($('#reviewType .dropdown-item'), function(index, item) {
                    item.addEventListener("click", function(e) {
                        // Stops event bubbling.
                        e.preventDefault();
                        e.stopPropagation();

                        var drowDowns = {
                            "Google Reviews" : getDataObj().reviews.getGoogleReviews(),                            
                            "Yalp Reviews": getDataObj().reviews.getYelpReviews()
                        };

                        drawReviews(drowDowns[this.innerHTML]);
                        setReviewDropdownActive(this.innerHTML.trim());
                        
                        // Set default order.
                        setOrderDropdownActive($('#reviewOrder .dropdown-item')[0].innerHTML.trim());
                    }, false);
                });

                // review order
                $.each($('#reviewOrder .dropdown-item'), function(index, item) {
                    item.addEventListener("click", function(e) {
                        // Stops event bubbling.
                        e.preventDefault();
                        e.stopPropagation();

                        setOrderDropdownActive(this.innerHTML.trim());

                        var dataObj = getDataObj();
                        var reviews = [];
                        ({
                            "Google Reviews" : dataObj.reviews.getGoogleReviews(),                            
                            "Yalp Reviews": dataObj.reviews.getYelpReviews()
                        })[$('#btnReviewType')[0].innerHTML.trim()].forEach(function (item) {
                            reviews.push(item);
                        });

                        var compareFunc = ({
                            "Default Order": undefined,
                            "Highest Rating": function(lhs, rhs) { return (lhs["rating"]==rhs["rating"]?0:(lhs["rating"]<rhs["rating"]?1:-1));},
                            "Lowest Rating": function(lhs, rhs) { return (lhs["rating"]==rhs["rating"]?0:(lhs["rating"]>rhs["rating"]?1:-1));},
                            "Most Recent": function(lhs, rhs) { return (lhs["time"]==rhs["time"]?0:(lhs["time"]<rhs["time"]?1:-1));},
                            "Least Recent": function(lhs, rhs) { return (lhs["time"]==rhs["time"]?0:(lhs["time"]>rhs["time"]?1:-1));}
                        })[this.innerHTML];

                        (function() {
                            if (compareFunc && (0 < reviews.length)) {
                                reviews.sort(compareFunc);
                            }

                            drawReviews(reviews);
                        })();
                    }, false);
                });

                // Keyup event controller
                $('#keyword').keyup(function(e) {
                    $('.needs-validation')[0].classList.remove('was-validated');
                    $('#send')[0].disabled = !isValidated();
                });

                // When the element gets focus, it removes validation style.
                $('#keyword').focus(function() {
                    $('.needs-validation')[0].classList.remove('was-validated');
                });

                // Checks the validation when the focus out
                $('#keyword').blur(function() {
                    if (0 < this.value.trim().length) {
                        $('.needs-validation')[0].classList.remove('was-validated');
                    } else {
                        this.value = "";
                        $('.needs-validation')[0].classList.add('was-validated');
                    }

                    $('#send')[0].disabled = !isValidated();
                });

                // Keyup event controller
                $('#addr').keyup(function(e) {
                    $('.needs-validation')[1].classList.remove('was-validated');
                    $('#send')[0].disabled = !isValidated();
                });

                // When the element gets focus, it removes validation style.
                $('#addr').focus(function() {
                    $('.needs-validation')[1].classList.remove('was-validated');
                });

                // Checks the validation when the focus out
                $('#addr').blur(function() {
                    if (0 < this.value.trim().length) {
                        $('.needs-validation')[1].classList.remove('was-validated');
                    } else {
                        this.value = "";
                        $('.needs-validation')[1].classList.add('was-validated');
                    }

                    $('#send')[0].disabled = !isValidated();
                });
                
            
                // Retrieve geolocation code of ip address.
                getIpGeo("http://ip-api.com/json/");
            
                // Retrive google map api script.
                // var googleObj = document.createElement("script");
                // googleObj.setAttribute("async", "");
                // googleObj.setAttribute("src", "https://maps.googleapis.com/maps/api/js?key=google_map_api_key_for_place&callback=initMap");
                // document.getElementsByTagName("head")[0].appendChild(googleObj);
            };

            // Retrieve geolocation code of ip address.
            function getIpGeo(url) {
                var query = url + "?callback=ipGeoCallback";
                
                scriptObj = document.createElement("script");
                scriptObj.setAttribute("type", "text/javascript");                
                scriptObj.setAttribute("charset", "utf-8");
                scriptObj.setAttribute("src", query + '&noCacheIE=' + (new Date()).getTime());
            
                // Disable submit button until the geolocation data is responsed.                
                document.getElementsByTagName("head")[0].appendChild(scriptObj);
            }

            // JSONP callback function
            function ipGeoCallback(jsonData) {
                console.log(jsonData);
                document.getElementsByTagName("head")[0].removeChild(scriptObj);
                if ("status" in jsonData && ("success" != jsonData.status)) {    //http://ip-api.com/json/
                    getIpGeo("https://ipapi.co/jsonp/");
                    return;
                } else if ("postal" in jsonData && (null == jsonData.latitude || undefined == jsonData.latitude)) {  //https://ipapi.co/jsonp/
                    getIpGeo("https://freegeoip.net/json/");
                    return;
                } else if ("metro_code" in jsonData && (null == jsonData.latitude || undefined == jsonData.latitude)) {  //https://freegeoip.net/json/
                        // Default location is geocode of University of Southern California.
                        sessionStorage.currentLatitude = "34.0223519";
                        sessionStorage.currentLongitude = "-118.285117";

                        sessionStorage.latitude = "34.0223519";
                        sessionStorage.longitude = "-118.285117";
                } else {
                
                    sessionStorage.currentLatitude = jsonData.lat;
                    sessionStorage.currentLongitude = jsonData.lon;

                    sessionStorage.latitude = jsonData.lat;
                    sessionStorage.longitude = jsonData.lon;
                }

                initMap();
            }

            function initMap() {
                var lat = Number(sessionStorage.currentLatitude);
                var lng = Number(sessionStorage.currentLongitude);
                var defaultBounds = new google.maps.LatLngBounds(new google.maps.LatLng(lng, lng));
                var autocomplete = new google.maps.places.Autocomplete($('#addr')[0], defaultBounds);

                // Create google map obj and generate single object.
                createGoogleMapObj();
            }

            // Active/inactive pill buttons
            function setPillActive(pill) {
                var pillLinks = $('.nav-pills a');
                for (var i=0; i<pillLinks.length; i++) {
                    if (pillLinks[i].innerHTML.trim() == pill) {
                        pillLinks[i].setAttribute("class", `${pillLinks[i].getAttribute("class")} active`);
                    } else {
                        pillLinks[i].setAttribute("class", pillLinks[i].getAttribute("class").replace(/( active)/g, ""));
                    }
                }
            }

            // Returns active status of the pill
            function isPillActive(pill) {
                var pillLinks = $('.nav-pills a');
                for (var i=0; i<pillLinks.length; i++) {
                    if (pillLinks[i].innerHTML.trim() == pill) {
                        return (0 < pillLinks[i].getAttribute("class").indexOf(" active"));
                    }
                }
            }

            // Acrive/inactive tab buttons
            function setNavActive(tab) {
                var tabLinks = $('.nav-tabs a');
                for (var i=0; i<tabLinks.length; i++) {
                    if (tabLinks[i].innerHTML.trim() == tab) {
                        tabLinks[i].classList.add('active');
                    } else {
                        tabLinks[i].classList.remove('active');
                    }
                }
            }

            // Return true when the elements have values which are not space.
            function isValidated() {
                if ((false == $('#keyword')[0].disabled) && (0 == $('#keyword')[0].value.trim().length)) {
                    return false;
                }

                if ((false == $('#addr')[0].disabled) && (0 == $('#addr')[0].value.trim().length)) {
                    return false;
                }

                return true;
            }

            // Progress bar controller
            function setProgress(value) {
                var progressBar = $('.progress-bar')[0];
                progressBar.setAttribute("aria-valuenow", value);
                progressBar.style.width = `${value}%`;

            }

            // Result div animation controller
            function showSlide(dest) {
                var slides = [$('#slide1'), $('#slide2')];

                // Initialize both slides
                slides[0][0].checked = true;
                slides[1][0].checked = true;
                slides[0].trigger("click");
                slides[1].trigger("click");

                // Show slide
                slides[dest].trigger("click");
            }

            // Return active slide
            function getActiveSlide() {
                var slides = [$('#listDiv')[0].classList.contains("ng-hide"), $('#detailDiv')[0].classList.contains("ng-hide")];
                
                if (slides[0] && slides[1]) {
                    return -1;
                } else if (slides[0]) {
                    return 1;
                }

                return 0;
            }

            // Change dropdown input
            function setReviewDropdownActive(type) {
                $('#btnReviewType')[0].innerHTML = type;
                $('#reviewType')[0].classList.remove("show");
            }

            // Change dropdown input
            function setOrderDropdownActive(order) {
                var dataObj = getDataObj();
                var drowDowns = {
                    "Google Reviews" : dataObj.reviews.getGoogleReviews(),                            
                    "Yalp Reviews": dataObj.reviews.getYelpReviews()
                };
                
                $('#btnReviewOrder')[0].innerHTML = order;
                $('#reviewOrder')[0].classList.remove("show");
            }

            function drawList(listType) {
                var dataObj = getDataObj();
                var types = {
                    Result: {
                        data: dataObj.getResult(),
                        func: renderResult
                    },
                    Favorites:  {
                        data: dataObj.getFavorite(),
                        func: renderFavorites
                    }
                };

                if (types[listType].data) {
                    dataObj.setCurFavoritePageIdx(0);
                    types[listType].func(types[listType].data);
                }
            }

            // Render result table
            function renderResult(results) {
                console.log(results);

                if (0 < results.length) {
                    var tableEle = document.getElementById("resultTable");

                    // Resets table.
                    var tbodyEle = tableEle.getElementsByTagName("tbody");
                    if (0 < tbodyEle.length) {
                        tbodyEle[0].remove();
                    }
                    tbodyEle = document.createElement('tbody');

                    for (var i=0; i<results.length; i++) {
                        var trEle = tbodyEle.insertRow(i);
                        
                        // First column (#)
                        trEle.innerHTML = `<th scope="row">${i+1}</th>`;

                        // Second column (icon)
                        trEle.insertCell(1).innerHTML = '<img class="categoryImg" src="' + results[i].icon + '" />';
                        
                        // Third column (name)
                        var nameEle = document.createElement("span");
                        nameEle.innerHTML = results[i].name;
                        trEle.insertCell(2).append(nameEle);

                        // Fourth column (addr)
                        var addrEle = document.createElement("span");
                        addrEle.innerHTML = results[i].vicinity;

                        var cell = trEle.insertCell(3);
                        cell.style.textAlign = "left";
                        cell.append(addrEle);
                        
                        // Fifth column (Favorite)
                        var btnFavorite = document.createElement("input");
                        btnFavorite.setAttribute("class", "btn btn-outline-dark font-weight-bold");
                        btnFavorite.setAttribute("type", "button");
                        btnFavorite.addEventListener("click", function() {
                            var dataObj = getDataObj();
                            var results = dataObj.getResult();
                            var favorites = dataObj.getFavorite();
                            var selectedIdx = Number(this.parentNode.parentNode.firstChild.innerText)-1;

                            if (results[selectedIdx].favorite) {
                                drawFavorite({ ele: this, isFavorite: false });
                                results[selectedIdx].favorite = false;
                                for (var i=0; i<favorites.length; i++) {
                                    if (results[selectedIdx].place_id == favorites[i].place_id) {
                                        favorites.splice(i,1);                                        
                                    }
                                }
                                dataObj.setFavorite(favorites);
                            } else {
                                drawFavorite({ ele: this, isFavorite: true });
                                results[selectedIdx].favorite = true;
                                favorites.push(results[selectedIdx]);
                                dataObj.setFavorite(favorites);
                            } 
                        }, false);

                        var favorites = getDataObj().getFavorite();
                        for (var j=0; j<favorites.length; j++) {
                            if (results[i].place_id == favorites[j].place_id) {
                                results[i].favorite = true;
                            }
                        }

                        drawFavorite({ ele: btnFavorite, isFavorite: results[i].favorite });
                        trEle.insertCell(4).append(btnFavorite);

                        // Sixth column (Details)
                        var btnDetail = document.createElement("input");
                        btnDetail.setAttribute("class", "btn btn-outline-dark font-weight-bold");
                        btnDetail.setAttribute("type", "button");
                        btnDetail.setAttribute("value", ">");
                        btnDetail.setAttribute("placeid", results[i].place_id);
                        btnDetail.addEventListener("click", function() {
                            retrieveDetail(this.getAttribute("placeid"));

                            var rows = $('#resultTable tr');
                            var dataObj = getDataObj();
                            var results = dataObj.getResult();
                            var favorites = dataObj.getFavorite();
                            
                            var selectedIdx = Number(this.parentNode.parentNode.firstElementChild.innerText);
                            var classStr = rows[selectedIdx].getAttribute("class");
                            
                            // for (var i=0; i<results.length; i++) {
                            //     if (results[i].selected && (i+1) != selectedIdx) {
                            //         drawSelected({ ele: rows[i+1], selected: false});
                            //         results[i].selected = false;
                            //     } else if ((i+1) == selectedIdx) {
                            //         drawSelected({ ele: rows[selectedIdx], selected: true});
                            //         results[i].selected = true;
                            //     }
                            // }

                            // // Set highliting for the favorites list
                            // for (var i=0; i<favorites.length; i++) {
                            //     if (favorites[i].selectedInFavorite && favorites[i].place_id != this.getAttribute("placeid")) {
                            //         favorites[i].selectedInFavorite = false;
                            //     } else if (favorites[i].place_id == this.getAttribute("placeid")) {
                            //         favorites[i].selectedInFavorite = true;
                            //     }
                            // }
                            // dataObj.setFavorite(favorites);
                        });

                        trEle.insertCell(5).append(btnDetail);

                        // Set highlighting if the row is selected.
                        if (false == $('#btnDetails')[0].disabled) {
                            var info = getDataObj().getInfo();
                            if (results[i].place_id == info.place_id) {
                                drawSelected({ ele: trEle, selected: true });
                            }
                        }
                    }
                    
                    tableEle.append(tbodyEle);
                    $('#btnNext')[0].style.display = results.next_page_token?"":"none";
                    $('#btnPrev')[0].style.display = results.prev?"":"none";
                    
                    $('#resultTableDiv')[0].style.display = "";
                    $('#resultDiv .alert-warning')[0].style.display = "none";
                    $('#btnDetails')[0].style.display = "";
                } else {
                    $('#resultTableDiv')[0].style.display = "none";
                    $('#resultDiv .alert-warning')[0].style.display = "";
                    $('#btnDetails')[0].style.display = "none";
                }
                
                $('#resultDiv')[0].style.display = "";
                $('#favoriteDiv')[0].style.display = "none";
            }

            // Render result table
            function renderFavorites(favorites) {                
                console.log(favorites);

                if (0 < favorites.length) {
                    var tableEle = $('#favoriteTable')[0];

                    // Resets table.
                    var tbodyEle = tableEle.getElementsByTagName("tbody");
                    if (0 < tbodyEle.length) {
                        tbodyEle[0].remove();
                    }
                    tbodyEle = document.createElement('tbody');

                    for (var i=0; i<favorites.length&&i<20; i++) {
                        var trEle = tbodyEle.insertRow(i);
                        
                        // First column (#)
                        trEle.innerHTML = `<th scope="row">${i+1}</th>`;

                        // Second column (icon)
                        trEle.insertCell(1).innerHTML = '<img class="categoryImg" src="' + favorites[i].icon + '" />';
                        
                        // Third column (name)
                        var nameEle = document.createElement("span");
                        nameEle.innerHTML = favorites[i].name;
                        trEle.insertCell(2).append(nameEle);

                        // Fourth column (addr)
                        var addrEle = document.createElement("span");
                        addrEle.innerHTML = favorites[i].vicinity;

                        var cell = trEle.insertCell(3);
                        cell.style.textAlign = "left";
                        cell.append(addrEle);
                        
                        // Fifth column (Favorite)
                        var btnFavorite = document.createElement("button");
                        btnFavorite.setAttribute("class", "btn btn-outline-dark font-weight-bold");
                        btnFavorite.innerHTML = '<i class="fas fa-trash-alt fa-xs"></i>';
                        btnFavorite.addEventListener("click", function() {
                            var selectedIdx = Number(this.parentNode.parentNode.firstChild.innerText);
                            var dataObj = getDataObj();
                            var results = dataObj.getResult();
                            var favorites = dataObj.getFavorite();

                            favorites[selectedIdx-1].favorite = false;
                            for (var i=0; i<results.length; i++) {
                                if (results[i].place_id == favorites[selectedIdx-1].place_id) {
                                    results[i].favorite = false;
                                }
                            }

                            favorites.splice(selectedIdx-1,1);
                            dataObj.setFavorite(favorites);
                            $('#favoriteTable')[0].deleteRow(selectedIdx);

                            var rows = $('#favoriteTable tr');
                            if (1 < rows.length) {
                                for (var i=selectedIdx; i<rows.length; i++) {
                                    rows[i].firstElementChild.innerHTML = Number(rows[i].firstElementChild.innerHTML)-1;
                                }
                            } else {
                                renderFavorites(favorites);
                            }
                        }, false);

                        drawFavorite({ ele: btnFavorite, isFavorite: favorites[i].favorite });
                        trEle.insertCell(4).append(btnFavorite);

                        // Sixth column (Details)
                        var btnDetail = document.createElement("input");
                        btnDetail.setAttribute("class", "btn btn-outline-dark font-weight-bold");
                        btnDetail.setAttribute("type", "button");
                        btnDetail.setAttribute("value", ">");
                        btnDetail.setAttribute("placeid", favorites[i].place_id);
                        btnDetail.addEventListener("click", function() {
                            var placeid = this.getAttribute("placeid")
                            retrieveDetail(placeid);

                            var rows = $('#favoriteTable tr');
                            var dataObj = getDataObj();
                            
                            var favorites = dataObj.getFavorite();
                            
                            var selectedIdx = Number(this.parentNode.parentNode.firstElementChild.innerText);
                            var classStr = rows[selectedIdx].getAttribute("class");
                            
                            // for (var i=0; i<favorites.length; i++) {
                            //     if (favorites[i].selectedInFavorite && (i+1) != selectedIdx) {
                            //         drawSelected({ ele: rows[i+1], selected: false});
                            //         favorites[i].selectedInFavorite = false;
                            //     } else if ((i+1) == selectedIdx) {
                            //         drawSelected({ ele: rows[selectedIdx], selected: true});
                            //         favorites[i].selectedInFavorite = true;
                            //     }
                            // }

                            // dataObj.setFavorite(favorites);

                            // // Set highliting for the result list
                            // var results = dataObj.getResult();
                            // for (; results.prev; results=results.prev);
                            // do {
                            //     results.forEach(function(item) {
                            //         if (item.selected && item.place_id == placeid) {
                            //             item.selected = false;
                            //         } else if (item.place_id == placeid) {
                            //             item.selected = true;
                            //         }
                            //     });
            
                            //     results = results.next;
                            // } while (results);
                        });

                        trEle.insertCell(5).append(btnDetail);
                        // Set highlighting if the row is selected.
                        if (false == $('#btnDetails')[0].disabled) {
                            var info = getDataObj().getInfo();
                            if (favorites[i].place_id == info.place_id) {
                                drawSelected({ ele: trEle, selected: true });
                            }
                        }
                    }

                    tableEle.append(tbodyEle);
                    
                    tableEle.style.display = "";
                    var dataObj = getDataObj();
                    var fullList = dataObj.getFavorite();
                    
                    $('#btnFavoriteNext')[0].style.display = (20<favorites.length)?"":"none";
                    $('#btnFavoritePrev')[0].style.display = (fullList[0].place_id == favorites[0].place_id)?"none":"";
                    $('#favoriteDiv .alert-warning')[0].style.display = "none";
                    $('#btnDetails')[0].style.display = "";
                } else {
                    $('#favoriteTable')[0].style.display = "none";
                    $('#favoriteDiv .alert-warning')[0].style.display = "";
                    $('#btnDetails')[0].style.display = "none";
                }

                $('#resultDiv')[0].style.display = "none";
                $('#favoriteDiv')[0].style.display = "";
            }

            function drawSelected({
                ele,
                selected
            }) {
                // var classStr = ele.getAttribute("class") || "";
                if (selected) {
                    // ele.setAttribute("class", `${classStr} table-warning`);
                    ele.classList.add('table-warning');
                } else {
                    ele.classList.remove('table-warning');
                    // ele.setAttribute("class", classStr.replace(/( table-warning)/g, ""));
                }
            }

            function drawFavorite({
                ele,
                isFavorite
            }) {
                var classStr = ele.getAttribute("class");
                if (isFavorite) {
                    ele.setAttribute("class", `${classStr} favorite`);
                    ele.setAttribute("value", "★");
                } else {
                    ele.setAttribute("class", classStr.replace(/( favorite)/g, ""));
                    ele.setAttribute("value", "☆");
                }
            }

            // Retrieve place detail data from google.
            function retrieveDetail(placeid) {
                var dataObj = getDataObj();
                var results = null;
                        
                if (isPillActive("Result")) {
                    results = dataObj.getResult();
                    for (; results.prev; results=results.prev);
                } else {
                    results = dataObj.getFavorite();
                }

                loadJSON({
                    url: '/googlemap/placedetail',
                    actionType: "GET",
                    data: `placeid=${placeid}`,
                    async: true,
                    progress: true,
                    callback: function(retStr) {
                        if (0 < retStr.length) {
                            try {
                                var retObj = JSON.parse(retStr);
                                console.log(retObj);
                                
                                // favorite style
                                do {
                                    results.forEach(function(item) {
                                        if (item.place_id == retObj.place_id) {
                                            retObj.link = item;
                                            drawFavorite({ ele: $('#btnFavorite')[0], isFavorite: item.favorite });
                                        }
                                    });
                
                                    results = results.next;
                                } while (results);

                                // Reset nav-tabs
                                setNavActive("Info");
                                
                                // Info Table
                                dataObj.setInfo(retObj);
                                drawInfoTable(retObj);

                                // Google map Table
                                drawGoogleMap(retObj);

                                // Photos Table
                                if (retObj.photos && 0 < retObj.photos.length) {
                                    var photos = [];
                                    for (let i=0; i<retObj.photos.length; i++) {
                                        let photo = retObj.photos[i];
                                        let dataStr = `maxheight=${photo.width}&maxwidth=${photo.height}&photo_reference=${photo.photo_reference}`;
                                        
                                        loadJSON({
                                            url: 'googlemap/photourl',
                                            actionType: "GET",
                                            data: dataStr,
                                            async: true,
                                            callback: function(urlStr) {
                                                if (0 < urlStr.length) {
                                                    var urlObj = JSON.parse(urlStr);
                                                    photos[i] = {
                                                        width: photo.width,
                                                        height: photo.height,
                                                        url: urlObj.url
                                                    };

                                                    var count = photos.filter(function() { return true; }).length
                                                    if (count == retObj.photos.length) {
                                                        dataObj.setPhotos(photos);
                                                        drawImageThumbnails(photos);
                                                    }
                                                }
                                            }
                                        });
                                    }
                                } else {
                                    var photos = [];
                                    dataObj.setPhotos(photos);
                                    drawImageThumbnails(photos);
                                }

                                // Reviews Table
                                if (retObj.reviews && 0 < retObj.reviews.length) {
                                    dataObj.reviews.setGoogleReviews(retObj.reviews);
                                } else {
                                    dataObj.reviews.setGoogleReviews([]);
                                }

                                var dataStr = `location=${retObj.formatted_address||""}`;
                                if (retObj.international_phone_number) dataStr += `&phone=${retObj.international_phone_number.replace(/[ -]/g, "")||""}`;
                                dataStr += `&term=${retObj.name||""}`;
                                loadJSON({
                                    url: 'yelpQuery',
                                    actionType: "GET",
                                    data: dataStr,
                                    async: true,
                                    callback: function(reviewStr) {
                                        if (0 < reviewStr.length) {
                                            var reviewObj = JSON.parse(reviewStr);
                                            console.log(reviewObj);
                                            if (0 < reviewObj.reviews.length) {
                                                var reviews = [];
                                                for (var i=0; i<reviewObj.reviews.length; i++) {
                                                    reviews[i] = {
                                                        author_name: reviewObj.reviews[i].user.name,
                                                        author_url: reviewObj.reviews[i].url,
                                                        profile_photo_url: reviewObj.reviews[i].user.image_url,
                                                        rating: reviewObj.reviews[i].rating,
                                                        time: moment(reviewObj.reviews[i].time_created).unix(),
                                                        text: reviewObj.reviews[i].text
                                                    };
                                                }

                                                dataObj.reviews.setYelpReviews(reviews);
                                            }
                                        }
                                    }
                                });

                                // Reset review type dropdown.
                                setReviewDropdownActive($('#reviewType .dropdown-item')[0].innerHTML.trim());
                        
                                // Reset order type dropdown.
                                setOrderDropdownActive($('#reviewOrder .dropdown-item')[0].innerHTML.trim());

                                // Draws reviews
                                drawReviews(dataObj.reviews.getGoogleReviews());

                                $('#infoDiv')[0].style.display = "";
                                $('#photoDiv')[0].style.display = "none";
                                $('#mapDiv')[0].style.display = "none";
                                $('#reviewDiv')[0].style.display = "none";

                                // Show detail view
                                showSlide(1);
                            } catch (e) {
                                if (e instanceof SyntaxError) {
                                    alert("Fail to parse JSON.");
                                }

                                console.log(e);
                            }
                        }
                    }
                });
            }

            // Create google map api object and Initialize
            // and change it self to singleton function.
            function createGoogleMapObj() {                
                var singleObj = null;

                return (function() {
                    var mapDiv = document.getElementById("map");
                    var panel = document.getElementById("panel");
                    var panoDiv = document.getElementById("pano");

                    var origin = { "lat" : null, "lng" : null };
                    var dest = { "lat" : null, "lng" : null };
                    var map = null;
                    var marker = null;
                    var panorama = null;
                    var directionsDisplay = null;

                    
                    // Initialize map object.
                    // If a map object is not created, create map, marker, amd directionDisplay object,
                    // else reset these object.
                    // Return a map object for both cases.
                    function initMap() {
                        console.log("initMap");
                        
                        map = new google.maps.Map(mapDiv);
                        marker = new google.maps.Marker();
                        panorama = new google.maps.StreetViewPanorama(panoDiv);
                        directionsDisplay = new google.maps.DirectionsRenderer(/*{suppressMarkers: true}*/);

                        // Create single object.
                        return {
                            "clearMap" : clearMap
                            , "moveToMapPosition" : moveToMapPosition
                            , "showMap" : showMap
                            , "isVisible" : isVisible
                            , "setOriginPosition" : setOriginPosition
                            , "setMapCenterPosition" : setMapCenterPosition
                            , "setMapZoomLevel" : setMapZoomLevel
                            , "setMarkerLocation" : setMarkerLocation
                            , "clearMarker" : clearMarker
                            , "displayRoute" : displayRoute
                            , "clearRoute" : clearRoute
                            , "setStreetView" : setStreetView
                            , "clearStreetView" : clearStreetView
                            , "getLatitude" : getLatitude
                            , "getLongitude" : getLongitude
                        };
                    }

                    // Clear map. Remove marker, route and streetview panorama.
                    function clearMap() {
                        clearMarker();
                        clearRoute();
                    }

                    // Sets the position of a map on the screen.
                    function moveToMapPosition(left, top) {
                        mapDiv.style.left = left;
                        mapDiv.style.top = top;

                        panel.style.left = left;
                        panel.style.top = top;
                    }

                    function showMap(show) {
                        var displays = ["none", ""];
                        mapDiv.style.display = displays[(true == show ? 1 : 0)];
                        panel.style.display = displays[(true == show ? 1 : 0)];
                    }

                    function isVisible() {
                        return mapDiv.style.display != "none";
                    }

                    // Sets the origin location for the directionsDisplay
                    function setOriginPosition(lat, lng) {
                        origin = { "lat" : Number(lat), "lng" : Number(lng) };
                    }

                    // Sets the center location of the map to argument location.
                    function setMapCenterPosition(lat, lng) {
                        dest = { "lat" : Number(lat), "lng" : Number(lng) };
                        map.setCenter(dest);

                        // Initialize panorama streetview
                        setPanoPosition(dest);
                        setPanoPov(34, 10);
                        // map.setStreetView(panorama);
                    }

                    // sets the zoom level of the map.
                    function setMapZoomLevel(level) {
                        map.setZoom(level);
                    }

                    // Sets the location of a marker in the map to argument location.
                    function setMarkerLocation(lat, lng) {
                        dest = { "lat" : Number(lat), "lng" : Number(lng) };
                        marker.setPosition(dest);
                        marker.setMap(map);
                    }

                    // Removes the marker from the map, but keeps it in the variable.
                    function clearMarker() {
                        marker.setMap(null);
                    }
                    
                    function displayRoute(travelMode) {
                        var directionsService = new google.maps.DirectionsService();

                        directionsService.route({
                            origin: origin,
                            destination: dest,
                            travelMode: google.maps.TravelMode[travelMode],
                            provideRouteAlternatives: true
                        }, function(response, status) {
                            if (status == 'OK') {
                                directionsDisplay.setDirections(response);
                                directionsDisplay.setMap(map);
                                directionsDisplay.setPanel(panel);

                                // var leg = response.routes[ 0 ].legs[ 0 ];
                                // var marker1 = new google.maps.Marker({
                                //     position: leg.start_location,
                                //     map: map,
                                //     fillColor : "green",
                                //     title: "A"
                                // });

                                // new google.maps.Marker({
                                //     position: leg.end_location,
                                //     map: map,
                                //     fillColor : "red",
                                //     title: "B"
                                // });
                            } else {
                                if ("ZERO_RESULTS" == status) {
                                    alert(`Cannot find route from "${$('#origin')[0].value}" to "${$('#destination')[0].value}"`);
                                }
                            }
                        });
                    }

                    function clearRoute() {
                        directionsDisplay.setMap(null);
                    }

                    function setPanoPosition(position) {
                        panorama.setPosition(position);
                    }

                    function setPanoPov(heading, pitch) {
                        panorama.setPov({heading: heading, pitch: pitch});
                    }

                    // setPanorama streetview 
                    function setStreetView() {
                        map.setStreetView(panorama);
                        panorama.setVisible(true);
                    }

                    // Removes the panorama street view from the map, but keeps it in the variable.
                    function clearStreetView() {
                        panorama.setVisible(false);
                    }

                    function getLatitude() {
                        return dest.lat;
                    }

                    function getLongitude() {
                        return dest.lng;
                    }

                    singleObj = initMap();

                    createGoogleMapObj = function() {
                        return singleObj;
                    }
                    
                    return singleObj;
                })();
            }

            // Stores transaction data.
            var getDataObj = (function(placeid) {
                var detailObj = null;

                function createDetailObj(placeid) {
                    this.placeid = placeid;

                    var results = null;
                    var favorites = [];

                    var info = null;
                    var photos = null;

                    var curFavoritePageIdx = 0;
                    
                    var reviews = (function() {
                        var googleReviews = null;
                        var yelpReviews = null;

                        function setGoogleReviews(reviews) {
                            googleReviews = reviews;
                        }

                        function getGoogleReviews() {
                            return googleReviews;
                        }

                        function setYelpReviews(reviews) {
                            yelpReviews = reviews;
                        }

                        function getYelpReviews() {
                            return yelpReviews;
                        }

                        return {
                            setGoogleReviews: setGoogleReviews,
                            getGoogleReviews: getGoogleReviews,
                            setYelpReviews: setYelpReviews,
                            getYelpReviews: getYelpReviews
                        }
                    })();

                    function getFavorite() {
                        var favorites = [];
                        
                        try { 
                            var obj = JSON.parse(localStorage.getItem("favorites"));
                            
                            for (var i=0; i<obj.length; i++) {
                                favorites.push(obj[i]);
                            }
                        } catch (e) {
                            console.log(e);
                        }

                        return favorites;
                    }

                    function setFavorite(items) {
                        var obj = {};
                        for (var i=0; i<items.length; i++) {
                            obj[i] = items[i];
                        }
                        obj.length = items.length;

                        localStorage.setItem("favorites", JSON.stringify(obj));
                        favorites = items;
                    }

                    function getCurFavoritePageIdx() {
                        return curFavoritePageIdx;
                    }

                    function setCurFavoritePageIdx(idx) {
                        curFavoritePageIdx = idx;
                    }

                    if (null == localStorage.getItem("favorites")) {
                        setFavorite([]);
                    }

                    return {
                        getResult: function() { return results; },
                        setResult: function(items) { results = items; },
                        getFavorite: getFavorite,
                        setFavorite: setFavorite,
                        getCurFavoritePageIdx: getCurFavoritePageIdx,
                        setCurFavoritePageIdx: setCurFavoritePageIdx,
                        getInfo: function() { return info; },
                        setInfo: function(items) { info = items; },
                        getPhotos: function() { return photos; },
                        setPhotos: function(items) { photos = items; },                        
                        reviews: reviews
                    };
                }

                return function() {
                    if (null == detailObj) {
                        detailObj = createDetailObj(placeid);
                    }

                    return detailObj;
                };  
            })();

            // Retrieves a rating stars element.
            function getRatingStar(rating) {
                var retEle = document.createElement("ul");
                retEle.setAttribute("class", "list-inline");
                retEle.setAttribute("style", "margin-bottom: 0");

                for (var i=0; i<rating; i++) {
                    var liEle = document.createElement("li");
                    liEle.setAttribute("class", "list-inline-item clearfix");
                    if (0 < Math.floor(rating-i)) {
                        liEle.setAttribute("style", "overflow: hidden; margin-right: 0.2rem");
                    } else {
                        liEle.setAttribute("style", `overflow: hidden; margin-right: 0.2rem; width:${12*(rating-i)}px;`);
                    }

                    var img = document.createElement("img");
                    img.setAttribute("src", "full_star.png");
                    img.setAttribute("class", "fullFill");
                    liEle.append(img);
                    retEle.append(liEle);
                }

                return retEle;
            }

            // Draw Detailed View
            function renderPlaceDetail(placeDetailJSON) {
                console.log(placeDetailJSON);
            }

            // placeDetailJSON.result
            function drawInfoTable(info) {

                $("#detailDiv h4")[0].innerHTML = info.name;

                var tableEle = $('#infoTable')[0];
                var tbodyEle = tableEle.getElementsByTagName("tbody");
                if (0 < tbodyEle.length) {
                    tbodyEle[0].remove();
                }
                tbodyEle = document.createElement('tbody');
                tableEle.append(tbodyEle);

                var rowIndex = 0;

                // Address
                if (info.formatted_address) {
                    var row = tbodyEle.insertRow(rowIndex++);
                    row.innerHTML = '<th scope="row" class="infoCell0">Address</th>';
                    var col = document.createElement('td');
                    col.setAttribute("class", "infoCell1");
                    col.innerHTML = info.formatted_address;
                    row.append(col);
                }

                // Phone Number
                if (info.international_phone_number) {
                    row = tbodyEle.insertRow(rowIndex++);
                    row.innerHTML = '<th scope="row">Phone Number</th>';
                    var col = document.createElement('td');
                    col.innerHTML = info.international_phone_number;
                    row.append(col);
                }

                // Price Level
                if (info.price_level) {
                    var priceLevel = "";
                    if (info.price_level) {
                        for (var i=0; i<info.price_level; i++) {
                            priceLevel += "$";
                        }
                    }
                    row = tbodyEle.insertRow(rowIndex++);
                    row.innerHTML = '<th scope="row">Price Level</th>';
                    var col = document.createElement('td');
                    col.innerHTML = priceLevel;
                    row.append(col);
                }
                
                // Rating
                if (info.rating) {
                    var divEle = document.createElement("div");
                    divEle.setAttribute("class", "list-inline");

                    var spanEle = document.createElement("span");
                    spanEle.innerHTML = info.rating;
                    spanEle.setAttribute("class", "mr-1 list-inline-item");
                    divEle.append(spanEle);

                    var ratingStar = getRatingStar(info.rating);
                    ratingStar.setAttribute("class", `${ratingStar.getAttribute("class")} list-inline-item`);
                    divEle.append(ratingStar);

                    row = tbodyEle.insertRow(rowIndex++);
                    row.innerHTML = '<th scope="row">Rating</th>';
                    var col = document.createElement('td');
                    col.append(divEle);
                    row.append(col);
                }

                // Google Page
                if (info.url) {
                    row = tbodyEle.insertRow(rowIndex++);
                    row.innerHTML = '<th scope="row">Google Page</th>';
                    var col = document.createElement('td');
                    col.innerHTML = `<a href='${info.url}' target='_default'>${info.url}</a>`;
                    row.append(col);
                }

                // Website
                if (info.website) {
                    row = tbodyEle.insertRow(rowIndex++);
                    row.innerHTML = '<th scope="row">Website</th>';
                    var col = document.createElement('td');
                    col.innerHTML = `<a href='${info.website}' target='_default'>${info.website}</a>`;
                    row.append(col);
                }
                
                // Hours
                if (info.opening_hours) {
                    var placeLocalDay = (moment().utcOffset(info.utc_offset).day()+6)%7;
                    var weekday_text = info.opening_hours.weekday_text;
                    var curOpenHours = weekday_text[placeLocalDay].substr(weekday_text[placeLocalDay].indexOf(": "));

                    var ele = createDailyOpenHourEle(weekday_text, weekday_text[placeLocalDay].substr(0, weekday_text[placeLocalDay].indexOf(": ")));
                    $('.modal-body')[0].firstElementChild.remove();
                    $('.modal-body')[0].append(ele);

                    var hoursAnchor = document.createElement("a");
                    hoursAnchor.setAttribute("href", "");
                    hoursAnchor.setAttribute("class", "ml-2");
                    hoursAnchor.setAttribute("data-toggle", "modal");
                    hoursAnchor.setAttribute("data-target", "#modalCenter");
                    hoursAnchor.innerHTML = "Daily open hours";

                    row = tbodyEle.insertRow(rowIndex++);
                    row.innerHTML = '<th scope="row">Hours</th>';
                    var col = document.createElement('td');
                    col.innerHTML = (info.opening_hours.open_now?`Open now${curOpenHours}`:"Closed");
                    col.append(hoursAnchor);
                    row.append(col);
                }
            }

            function drawImageThumbnails(photos) {
                var masonry = $('#masonry')[0];
                $('#masonry').empty();
                
                if (0 < photos.length) {
                    for (var i=0; i<photos.length; i++) {
                        var card = document.createElement("div");
                        card.setAttribute("class", "card");
                        card.innerHTML = `<a href="${photos[i].url}" target="_defalut"><img src="${photos[i].url}" class="img-thumbnail" /></a>`;
                        masonry.append(card);
                    }

                    masonry.style.display = "";
                    $('#photoDiv .alert-warning')[0].style.display = "none";
                } else {
                    $('#photoDiv .alert-warning')[0].style.display = "";
                    masonry.style.display = "none";
                }
            }

            function drawGoogleMap(info) {
                // Origination latitude and longitude
                var lat = Number(sessionStorage.latitude);
                var lng = Number(sessionStorage.longitude);

                // Set autocomplete
                var defaultBounds = new google.maps.LatLngBounds(new google.maps.LatLng(lat, lng));
                var autocomplete = new google.maps.places.Autocomplete($('#origin')[0], defaultBounds);
                autocomplete.addListener('place_changed', function() {
                    var place = autocomplete.getPlace();
                    // if (!place.geometry) {
                    //     // User entered the name of a Place that was not suggested and
                    //     // pressed the Enter key, or the Place Details request failed.
                    //     window.alert("No details available for input: '" + place.name + "'");
                    //     return;
                    // } else {
                    //     console.log(place);
                    // }
                });

                // Assign initial value into origin input box.
                var initOrigin = {
                    true: function() { return $('#addr')[0].value; },
                    false: function() { return "Your location"; }
                };
                $('#origin')[0].value = initOrigin[$('#fromRadio2')[0].checked]();

                // set destination
                $('#destination')[0].value = `${info.name}, ${info.formatted_address}`;

                // Set mode selecter to default(Driving).
                $('#mode')[0].selectedIndex = 0;

                // Set button click event for btnDirection
                $('#btnDirection').off('click');
                $('#btnDirection').on('click', function(e) {
                    new Promise(function(resolve, reject) {
                        var origin = {
                            true: function() {
                                resolve({
                                    lat: Number(sessionStorage.currentLatitude),
                                    lng: Number(sessionStorage.currentLongitude)
                                });
                            },
                            false: function() {
                                loadJSON({
                                    url: 'googlemap/geocode',
                                    actionType: "GET",
                                    data: `addr=${$('#origin')[0].value}`,
                                    async: true,
                                    callback: function(retStr) {                                        
                                        if (0 < retStr.length) {
                                            var retObj = JSON.parse(retStr);                                            
                                            resolve(0 < retObj.length ? {
                                                lat: Number(retObj[0].geometry.location.lat),
                                                lng: Number(retObj[0].geometry.location.lng)
                                            } : null);
                                        }
                                    }
                                });
                            }
                        };

                        var originStr = $('#origin')[0].value;
                        origin[(-1 < originStr.toLowerCase().indexOf("your location") || -1 < originStr.toLowerCase().indexOf("my location") || "" == originStr)]();
                    })
                    .then(function(geometry) {
                        var action = {
                            false: function() {
                                googleMapObj.clearMap();
                                googleMapObj.setOriginPosition(geometry.lat, geometry.lng);
                                googleMapObj.displayRoute($('#mode')[0].value);                                
                            },
                            true: function() {
                                alert(`Cannot find route from "${$('#origin')[0].value}" to "${$('#destination')[0].value}"`);
                            }
                        };

                        action[null===geometry]();
                    });
                    
                });
                
                // Get google a map object.
                var googleMapObj = createGoogleMapObj();
                
                // Set origination.
                googleMapObj.setOriginPosition(lat, lng);
                googleMapObj.showMap(false);

                googleMapObj.clearMap();
                googleMapObj.setMapCenterPosition(info.geometry.location.lat, info.geometry.location.lng);
                googleMapObj.setMapZoomLevel(15);
                googleMapObj.setMarkerLocation(info.geometry.location.lat, info.geometry.location.lng);

                // Add button events
                var divToggle = getToggle([$('#googleMapDiv')[0], $('#googlePanoDiv')[0]], 0);
                $('#btnStreetView').on('click', function(e) {
                    divToggle();                    
                    googleMapObj.setStreetView();
                });
                
                $('#btnMapView').on('click', function(e) {
                    googleMapObj.clearStreetView();
                    divToggle();
                });

                // Show google Map
                googleMapObj.showMap(true);
            }
            
            function drawReviews(reviews) {
                $('#fade1')[0].checked = true;
                $('#fade1').trigger("click");
                $('#fade1').trigger("click");
                var reviewDiv = $('#reviewMediaContainer')[0];
                // while (0 < reviewDiv.children.length) {
                //     reviewDiv.removeChild(reviewDiv.lastChild);
                // }

                if (0 < reviews.length) {
                    for (var i=0; i<reviews.length; i++) {
                        var card = document.createElement("div");
                        card.setAttribute("class", "card mt-2");
    
                        var media = document.createElement("div");
                        media.setAttribute("class", "card-body media");
    
                        var imgAnchor = document.createElement("a");
                        imgAnchor.setAttribute("href", reviews[i].author_url);
                        imgAnchor.setAttribute("target", "_defaulg");
    
                        var img = document.createElement("img");
                        img.setAttribute("class", "mr-3 rounded-circle reviewIcon");
                        img.setAttribute("src", reviews[i].profile_photo_url);                    
                        imgAnchor.append(img);
                        media.append(imgAnchor);
    
                        var mediaBody = document.createElement("div");
                        mediaBody.setAttribute("class", "media-body");
    
                        var headingAnchor = document.createElement("a");
                        headingAnchor.setAttribute("href", reviews[i].author_url);
                        headingAnchor.setAttribute("target", "_defaulg");
    
                        var heading = document.createElement("h5");
                        heading.setAttribute("class", "mt-0");
                        heading.innerHTML = reviews[i].author_name;
                        headingAnchor.append(heading);
                        mediaBody.append(headingAnchor);
                        
                        var rating = document.createElement("div");
                        rating.setAttribute("class", "list-inline");
    
                        var ratingStar = getRatingStar(reviews[i].rating);
                        ratingStar.setAttribute("class", `${ratingStar.getAttribute("class")} list-inline-item`);
                        rating.append(ratingStar);
    
                        var time = moment(reviews[i].time*1000).format("YYYY-MM-DD HH:mm:ss");
                        var spanEle = document.createElement("span");
                        spanEle.setAttribute("class", "ml-1");
                        spanEle.innerHTML = time;
                        
                        rating.append(spanEle);
                        mediaBody.append(rating);
                        
                        var text = document.createElement("div");
                        text.innerHTML = `<span>${reviews[i].text}</span>`;
                        mediaBody.append(text);
    
                        media.append(mediaBody);
                        card.append(media);
                        reviewDiv.append(card);
                    }

                    reviewDiv.style.display = "";
                    $('#reviewDiv .alert-warning')[0].style.display = "none";
                } else {
                    reviewDiv.style.display = "none";
                    $('#reviewDiv .alert-warning')[0].style.display = "";
                }
            }

            // Create an ul element and return.
            function createDailyOpenHourEle(weekday_text, curOpenHours) {
                var container = document.createElement("div");
                container.setAttribute("class", "container");
                
                weekday_text.forEach(function(item) {
                    var row = document.createElement("div");
                    row.setAttribute("class", "row py-1 border-top");

                    var col1 = document.createElement("div");
                    col1.setAttribute("class", "col-3");
                    col1.innerHTML = item.substr(0, item.indexOf(": "));
                    row.append(col1);

                    var col2 = document.createElement("div");
                    col2.setAttribute("class", "col");
                    col2.innerHTML = item.substr(item.indexOf(": ")+2);
                    row.append(col2);
                    
                    if (-1 < curOpenHours.indexOf(item.substr(0, item.indexOf(": ")))) {
                        row.setAttribute("class", `${row.getAttribute("class")} font-weight-bold`);
                        container.prepend(row);
                    } else {
                        container.append(row);
                    }
                });

                return container;
            }

            function getToggle([], defaultActiveIdx) {
                var eleList = arguments[0];
                var activeIdx = defaultActiveIdx-1;

                function toggle() {
                    var array = $.extend(true, [], eleList);
                    
                    activeIdx += 1;
                    activeIdx %= eleList.length;

                    var toActive = array.splice(activeIdx, 1);
                    array.forEach(function(item) {
                        item.style.display = "none";
                    });
                     
                    toActive[0].style.display = "";

                    return activeIdx;
                }
                
                toggle();

                return toggle;
            }

            function loadJSON({
                url,
                actionType,
                data,
                async,
                progress,
                callback
            }) {
                if (progress) {
                    $('#result')[0].style.display = "none";
                    $('#alertForFail')[0].style.display = "none";
                    $('#progress')[0].style.display = "";
                    setProgress(0);
                }

                if (true) {
                    if (progress) {
                        setProgress(50);
                    }

                    try {
                        $.ajax({ 
                            type: actionType
                            , url: url
                            , async: async
                            , data: strDataToJson(data)
                            , dataType: "json"
                            , success: function(data, status, xhr) {
                                if (4 == xhr.readyState) {                            
                                    if (200 == xhr.status) {
                                        
                                        if (xhr.responseText && 0 < xhr.responseText.length) {
                                            if (0 < "INVALID_REQUEST".indexOf(JSON.parse(xhr.responseText).status)) {
                                                // error.
                                            }
                                            callback(xhr.responseText);
                                        }
                                    } else if (404 == xhr.status) {
                                        alert("The json file doesn't exist on the url.");
                                    }

                                    if (progress) {
                                        $('#result')[0].style.display = "";
                                        $('#alertForFail')[0].style.display = "none";
                                        $('#progress')[0].style.display = "none";
                                    }
                                } else {
                                    if (progress) {
                                        var percent = [60, 80, 90, 100];
                                        setProgress(percent[xhr.readyState]);
                                    }
                                }
                            }
                            , error: function(xhr, statusText, errorThrown) {
                                if (-1 < "error".indexOf(statusText)) {
                                    $('#result')[0].style.display = "none";
                                    $('#alertForFail')[0].style.display = "";
                                    $('#progress')[0].style.display = "none";
                                    console.log(xhr.responseText);
                                }
                            } 
                        });
                    } catch (e) {
                        console.log(e);
                    }
                } else {
                    var xhr;
                    if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
                        xhr = new XMLHttpRequest();
                    } else { // code for IE6, IE5
                        xhr = new ActiveXObject("Microsoft.XMLHTTP");
                    } 

                    if (async) {
                        xhr.onreadystatechange = function() {
                            if (4 == xhr.readyState) {                            
                                if (200 == xhr.status) {
                                    
                                    if (xhr.responseText && 0 < xhr.responseText.length) {
                                        if (0 < "INVALID_REQUEST".indexOf(JSON.parse(xhr.responseText).status)) {
                                            // error.
                                        }
                                        callback(xhr.responseText);
                                    }
                                } else if (404 == xhr.status) {
                                    alert("The json file doesn't exist on the url.");
                                }

                                if (progress) {
                                    $('#result')[0].style.display = "";
                                    $('#alertForFail')[0].style.display = "none";
                                    $('#progress')[0].style.display = "none";
                                }
                            } else {
                                if (progress) {
                                    var percent = [60, 80, 90, 100];
                                    setProgress(percent[xhr.readyState]);
                                }
                            }
                        }
                    }

                    if ("GET" == actionType) {
                        url += ("?"+data);
                    }

                    xhr.open(actionType, url, async);
                    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    
                    try {
                        if (progress) {
                            setProgress(50);
                        }

                        var sendData = { POST: data };
                        xhr.send(sendData[actionType]);
                        if (false == async) {
                            if (404 == xhr.status && 4 == xhr.readyState) {
                                alert("The json file doesn't exist on the url.");
                                return "";
                            }

                            return xhr.responseText;
                        }
                    } catch (e) {                
                        if (e instanceof DOMException) {
                            if (0 == xhr.status && 4 == xhr.readyState) {
                                alert("Failed to load " + url + ": No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'null' is therefore not allowed access.");
                            } else {
                                console.log(e);
                                alert(e.message);
                            }
                            
                            return "";
                        }

                        console.log(e);
                    }
                }
            }

            function strDataToJson(dataStr) {
                var dataJson = {};
                var tokens = dataStr.split("&");
                tokens.forEach(function(token) {
                    var pair = token.split("=");
                    if (null != pair[0] && "" != pair[0]) {
                        dataJson[pair[0]] = pair[1];
                    }
                });

                return dataJson;
            }

        </script>
        
    </head>
    <body ng-app="ngAnimate">
        <div class="content">
            <div class="searchDiv mx-auto">
                <div class="text-center">
                    <h1>Travel and Entertainment Search</h1>
                </div>
                <div class="inputForm">
                    <form id="searchForm" novalidate>
                        <div class="form-group row">
                            <label for="keyword" class="col-sm-2 col-form-label reddot1">Keyword</label>
                            <div class="col-sm-10 needs-validation">
                                <input id="keyword" name="keyword" type="text" class="form-control" size=40 required />
                                <div class="invalid-feedback">
                                    Please enter a keyword.
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="type" class="col-sm-2 col-form-label">Category</label>
                            <div class="col-sm-10">
                                <select name="type" class="form-control shorter" required>
                                    <option value="default">Default</option>
                                    <option value="airport">Airport</option>
                                    <option value="amusement_park">Amusement Park</option>
                                    <option value="aquarium">Aquarium</option>
                                    <option value="art_gallery">Art Gallery</option>
                                    <option value="bakery">Bakery</option>
                                    <option value="bar">Bar</option>
                                    <option value="beauty_salon">Beauty Salon</option>
                                    <option value="bowling_alley">Bowling Alley</option>
                                    <option value="bus_station">Bus Station</option>
                                    <option value="cafe">Cafe</option>
                                    <option value="campground">Campground</option>
                                    <option value="car_rental">Car Rental</option>
                                    <option value="casino">Casino</option>
                                    <option value="lodging">Lodging</option>
                                    <option value="movie_theater">Movie Theater</option>
                                    <option value="museum">Museum</option>
                                    <option value="night_club">Night Club</option>
                                    <option value="park">Park</option>
                                    <option value="parking">Parking</option>
                                    <option value="restaurant">Restaurant</option>
                                    <option value="shopping_mall">Shopping Mall</option>
                                    <option value="stadium">Stadium</option>
                                    <option value="subway_station">Subway Station</option>
                                    <option value="taxi_stand">Taxi Stand</option>
                                    <option value="train_station">Train Station</option>
                                    <option value="travel_agency">Travel Agency</option>
                                    <option value="zoo">Zoo</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="radius" class="col-sm-2 col-form-label">Distance (miles)</label>
                            <div class="col-sm-10">
                                <input name="radius" type="number" class="form-control shorter" placeholder="10" size=5>
                            </div>
                        </div>
                        <fieldset class="form-group">
                            <div class="row">
                                <legend class="col-form-label col-sm-2 pt-0 reddot2">From</legend>
                                <div class="col-sm-10">
                                    <div class="form-check">
                                        <input id="fromRadio1" class="form-check-input" type="radio" name="from" value="Here" checked>
                                        <label class="form-check-label" for="fromRadio1">Current location</label>
                                    </div>
                                    <div class="form-check">
                                        <input id="fromRadio2" class="form-check-input" type="radio" name="from" value="location">
                                        <label class="form-check-label" for="fromRadio2">Other. Please specify:</label>
                                        <div class="needs-validation">
                                            <input id="addr" name="addr" type="text" class="form-control" placeholder="Enter a location" size="100" disabled="true" required>
                                            <div class="invalid-feedback">
                                                Please enter a location.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <!-- <input name="placeid" type="text" hidden="true"> -->
                        <div class="form-group row">
                            <div class="col-sm-10">
                                <button id="send" name="send" type="submit" class="btn btn-primary" value="Search" disabled="true"><i class="fas fa-search fa-xs"></i> Search</button>
                                <input id="Clear" type="button" class="btn btn-outline-primary" value="Clear">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <ul class="nav nav-pills mt-4 nav-center">                
                <li class="nav-item">
                    <a class="nav-link active" href="#">Result</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Favorites</a>
                </li>
            </ul>
            <div id="progress" class="mt-5" style="display:none">
                <div class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                </div>
            </div>
            <div id="result" style="display:none">
                <div>
                    <input type="checkbox" id="slide1" ng-model="slideCheck1" style="display:none">
                    <div id="listDiv" ng-show="slideCheck1">
                        <div class="text-right">
                            <input id="btnDetails" class="btn btn-outline-secondary" type="button" value="Details >" disabled=true />
                        </div>
                        <div id="resultDiv" class="mt-4"> 
                            <div id="resultTableDiv">
                                <table id="resultTable" class="table table-responsive table-hover ">
                                    <thead>
                                        <tr>
                                            <th scope="col" class="resultCell0">#</th>
                                            <th scope="col" class="resultCell1">Catagory</th>
                                            <th scope="col" class="resultCell2">Name</th>
                                            <th scope="col" class="resultCell3">Address</th>
                                            <th scope="col" class="resultCell4">Favorite</th>
                                            <th scope="col" class="resultCell5">Details</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                                <div id="pageBtns" class="text-center mt-3">
                                    <input id="btnPrev" class="btn btn-outline-dark" type="button" value="Prev" style="display:none" />
                                    <input id="btnNext" class="btn btn-outline-dark" type="button" value="Next" style="display:none" />
                                </div>
                            </div>
                            <div class="alert alert-warning mt-5" role="alert" style="display:none">
                                No records.
                            </div>
                        </div>
                        <div id="favoriteDiv" class="mt-4" style="display:none">
                            <div id="favoriteTableDiv">
                                <table id="favoriteTable" class="table table-responsive table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col" class="resultCell0">#</th>
                                            <th scope="col" class="resultCell1">Catagory</th>
                                            <th scope="col" class="resultCell2">Name</th>
                                            <th scope="col" class="resultCell3">Address</th>
                                            <th scope="col" class="resultCell4">Favorite</th>
                                            <th scope="col" class="resultCell5">Details</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                                <div id="favoritePageBtns" class="text-center mt-3">
                                    <input id="btnFavoritePrev" class="btn btn-outline-dark" type="button" value="Prev" style="display:none" />
                                    <input id="btnFavoriteNext" class="btn btn-outline-dark" type="button" value="Next" style="display:none" />
                                </div>
                            </div>
                            <div class="alert alert-warning mt-5" role="alert" style="display:none">
                                No records.
                            </div>
                        </div>
                    </div>   
                    <input type="checkbox" id="slide2" ng-model="slideCheck2" style="display:none">
                    <div id="detailDiv" class="mt-4" ng-show="slideCheck2">
                        <div class="text-center">
                            <h4>name</h4>
                        </div>
                        <div class="clearfix my-2">
                            <div class="float-left">
                                <input id="btnList" type="button" class="btn btn-outline-primary" value="< List">
                            </div>
                            <div class="float-right">
                                <input id="btnFavorite" type="button" class="btn btn-outline-primary" value="☆">               
                                <input id="btnTwitte" type="button" class="btn btn-outline-primary ml-1 twitterBtn" value="">
                            </div>
                        </div>
                        <div id="nav-tabs" class="clearfix">
                            <div class="float-right">
                                <ul class="nav nav-tabs">
                                    <li class="nav-item">
                                        <a id="infoTab" class="nav-link active" href="">Info</a>
                                    </li>
                                    <li class="nav-item">
                                        <a id="photosTab" class="nav-link" href="">Photos</a>
                                    </li>
                                    <li class="nav-item">
                                        <a id="mapTab" class="nav-link" href="">Map</a>
                                    </li>
                                    <li class="nav-item">
                                        <a id="reviewsTab" class="nav-link" href="">Reviews</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div id="infoDiv" class="mt-2">
                            <table id="infoTable" class="table table-responsive table-striped mt-2">                        
                                <tbody>
                                    <tr>
                                        <th scope="row" class="infoCell0">Address</th>
                                        <td class="infoCell1"></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Phone Number</th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Price Level</th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Rating</th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Google Page</th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Website</th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Hours</th>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="photoDiv">
                            <div id="masonry" class="card-columns mt-2">
                            </div>
                            <div class="alert alert-warning mt-5" role="alert" style="display:none">
                                No photo.
                            </div>
                        </div>
                        <div id="mapDiv" class="mt-2">
                            <div class="d-sm-flex flex-row">
                                <div class="col-sm-4 px-0 pr-1">
                                    <label for="origin" class="col-form-label">From</label>
                                    <input id="origin" type="text" class="form-control" placeholder="Your location" size="">                        
                                </div>
                                <div class="col-sm-4 px-1">
                                    <label for="destination" class="col-form-label">To</label>
                                    <input id="destination" type="text" class="form-control" size="" disabled="true">                            
                                </div>
                                <div class="col-sm-2 px-1">
                                    <label for="mode" class="col-form-label">Travel Mode</label>                            
                                    <select id="mode" name="mode" class="form-control shorter" required="">
                                        <option value="DRIVING">Driving</option>
                                        <option value="BICYCLING">Bicycling</option>
                                        <option value="TRANSIT">Transit</option>                                   
                                        <option value="WALKING">Walking</option>
                                    </select>
                                </div>
                                <div class="col-xs-1 py-2 py-sm-0 pl-sm-2">
                                    <label for="btnDirection" class="col-form-label d-none d-sm-block">&nbsp;</label>
                                    <input id="btnDirection" type="button" class="btn btn-primary" value="Get Directions">
                                </div>
                            </div>
                            <div id="googleMapDiv">
                                <div class="my-1">
                                    <input id="btnStreetView" type="button" class="btn btn-outline-secondary streetViewBtn" value="">
                                </div>
                                <div id="map" style="height:500px;">
                                </div>
                                <div id="panel">
                                </div>
                            </div>
                            <div id="googlePanoDiv">
                                <div class="my-1">
                                    <input id="btnMapView" type="button" class="btn btn-outline-secondary mapViewBtn" value="">
                                </div>
                                <div id="pano" style="height:500px;">
                                </div>
                            </div>
                        </div>
                        <div id="reviewDiv">
                            <div class="btn-group mt-3 mb-2 px-2">
                                <div class="dropdown">
                                    <button id="btnReviewType" class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Google Reviews
                                    </button>
                                    <div id="reviewType" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item" href="#">Google Reviews</a>
                                        <a class="dropdown-item" href="#">Yalp Reviews</a>                                
                                    </div>
                                </div>
                                <div class="dropdown ml-3">
                                    <button id="btnReviewOrder" class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Default Order
                                    </button>
                                    <div id="reviewOrder" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item" href="#">Default Order</a>
                                        <a class="dropdown-item" href="#">Highest Rating</a>
                                        <a class="dropdown-item" href="#">Lowest Rating</a>
                                        <a class="dropdown-item" href="#">Most Recent</a>
                                        <a class="dropdown-item" href="#">Least Recent</a>
                                    </div>
                                </div>
                            </div>
                            <input type="checkbox" id="fade1" ng-model="fadeIn" style="display:none">
                            <div ng-if="fadeIn" class="fade">
                                <div id="reviewMediaContainer">
                                </div>
                                <div class="alert alert-warning mt-5" role="alert" style="display:none">
                                    No review.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="alertForFail" class="alert alert-danger mt-5" role="alert" style="display:none">
                Failed to get search results.
            </div>            
        </div>
        <div class="modal fade" id="modalCenter" tabindex="-1" role="dialog" aria-labelledby="modalCenterTitle" style="display: none;" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalLongTitle">Open hours</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
